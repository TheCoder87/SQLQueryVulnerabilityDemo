using System.Data;
using System.Data.SqlClient;

namespace SQLQueryVulnerabilityDemo
{
    public class SqlQueriesClass
    {
        public object UnsafeQuery(string connection, string name, string password)
        {
            object accountNumber = null;
            using (SqlConnection someConnection = new SqlConnection(connection))
            {
                using (SqlCommand someCommand = new SqlCommand())
                {
                    someCommand.Connection = someConnection;

                    someCommand.CommandText = "SELECT AccountNumber FROM Users " +
                       "WHERE Username='" + name +
                       "' AND Password='" + password + "'";

                    someConnection.Open();
                    accountNumber =someCommand.ExecuteScalar();
                }
            }

            return accountNumber;
        }

        public object SaferQuery(string connection, string name, string password)
        {

            object accountNumber = null;
            using (SqlConnection someConnection = new SqlConnection(connection))
            {
                using (SqlCommand someCommand = new SqlCommand())
                {
                    someCommand.Connection = someConnection;

                    someCommand.Parameters.Add(
                       "@username", SqlDbType.NChar).Value = name;
                    someCommand.Parameters.Add(
                       "@password", SqlDbType.NChar).Value = password;
                    someCommand.CommandText = "SELECT AccountNumber FROM Users " +
                       "WHERE Username=@username AND Password=@password";

                    someConnection.Open();

                    accountNumber = someCommand.ExecuteScalar();
                }
            }
            
            return accountNumber;
        }
    }
}